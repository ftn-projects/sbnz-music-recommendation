<div class="recommendation-container">
    <div class="recommendation-content">
        <h1>Music Recommendations</h1>

        <!-- Preferences Section -->
        <div class="preferences-section">
            <h3>Preferences</h3>
            <form [formGroup]="preferencesForm">
                <div class="preferences-grid">
                    <!-- Profile Selection -->
                    <div class="preference-item full-width">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Select Profile</mat-label>
                            <mat-select formControlName="selectedProfile">
                                @for (profile of profiles(); track profile.id) {
                                    <mat-option [value]="profile.id">{{ profile.name }}</mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    </div>

                    <!-- Checkboxes -->
                    <div class="preference-item">
                        <mat-checkbox formControlName="includeExplicit" color="primary">
                            Include explicit tracks
                        </mat-checkbox>
                    </div>

                    <div class="preference-item">
                        <mat-checkbox formControlName="includeLibraryTracks" color="primary">
                            Include library tracks
                        </mat-checkbox>
                    </div>

                    <div class="preference-item">
                        <mat-checkbox formControlName="includeRecentTracks" color="primary">
                            Include recent tracks
                        </mat-checkbox>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button 
                        mat-raised-button 
                        color="primary" 
                        (click)="getRecommendations()"
                        [disabled]="isGetRecommendationsDisabled()">
                        @if (isLoading()) {
                            <mat-spinner diameter="20"></mat-spinner>
                            <span>Loading...</span>
                        } @else {
                            Get Recommendations
                        }
                    </button>

                    @if (recommendations().length > 0) {
                        <button 
                            mat-stroked-button 
                            (click)="clearRecommendations()">
                            Clear Results
                        </button>
                    }
                </div>
            </form>
        </div>

        <!-- Recommendations Section -->
        @if (recommendations().length > 0) {
            <div class="recommendations-section">
                <h3>Recommended for You</h3>
                <div class="track-list">
                    @for (track of recommendations(); track track.id) {
                        <div class="track-card" (click)="navigateToLibrary(track.title!)" style="cursor: pointer;">
                            <div class="track-main">
                                <div class="title-row">
                                    <h4>{{ track.title }}</h4>
                                    @if (track.explicit) {
                                        <span class="explicit-tag">E</span>
                                    }
                                    @if (track.releaseYear) {
                                        <span class="year">{{ track.releaseYear }}</span>
                                    }
                                </div>
                                <p>{{ track.artist }}</p>
                            </div>
                            <div class="track-details">
                                @if (track.duration) {
                                    <span class="duration">{{ formatDuration(track.duration) }}</span>
                                }
                            </div>
                            @if (track.genres && track.genres.length > 0) {
                                <div class="genre-tags">
                                    @for (genre of track.genres; track genre.id) {
                                        <span class="genre-tag">{{ genre.name }}</span>
                                    }
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        } @else if (!isLoading()) {
            <div class="empty-state">
                <mat-icon>recommend</mat-icon>
                <p>No recommendations yet</p>
                <p class="subtitle">Set your preferences and click "Get Recommendations" to discover new music</p>
            </div>
        }
    </div>
</div>
